<script src="https://giscus.app/client.js"
        data-repo="vlad-tokarev/vlad-tokarev.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkzMTY1ODAzMTU="
        data-category="giscus"
        data-category-id="DIC_kwDOEt6h284CzOXP"
        data-mapping="pathname"
        data-strict="1"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="{{ .Site.Language.Lang }}"
        crossorigin="anonymous"
        async>
</script>

<script>
(function() {
    function getGiscusTheme() {
        const theme = document.body.className.includes('dark') ? 'dark' : 'light';
        return theme;
    }

    function setGiscusTheme(theme) {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (iframe) {
            iframe.contentWindow.postMessage(
                { giscus: { setConfig: { theme: theme } } },
                'https://giscus.app'
            );
        }
    }

    // Set initial theme once Giscus loads
    window.addEventListener('message', function(event) {
        if (event.origin !== 'https://giscus.app') return;
        if (typeof event.data !== 'object' || !event.data.giscus) return;

        // Giscus is ready, set the correct theme
        setGiscusTheme(getGiscusTheme());
    });

    // Watch for theme changes via MutationObserver on body class
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.attributeName === 'class') {
                setGiscusTheme(getGiscusTheme());
            }
        });
    });

    observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });
})();
</script>
